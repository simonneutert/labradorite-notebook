<div id="memos-search-all" class="enable-search-keyboard-shortcut">
  <div class="row mb-4">
    <div class="col-12">
      <a href="/" class="btn btn-secondary">&larr; Back to Home</a>
      <h1 class="mt-3">Search All Memos</h1>
      <p class="text-muted">Comprehensive search across all your notes (up to <%= @mega_search_limit %> results)</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-12">
      <input id="search" 
             name="q"
             type="text" 
             value="<%= @query || '' %>" 
             class="form-control my-4" 
             placeholder="Ctrl/Cmd + K to search ..."
             autofocus
             hx-get="/memos/search-all/results"
             hx-trigger="keyup changed delay:200ms, search from:body"
             hx-target="#search-content"
             hx-indicator="#search-loading"
             hx-sync="this:abort">
    </div>
  </div>
  
  <script>
    // Update URL with query parameter when search completes
    document.getElementById('search').addEventListener('htmx:afterRequest', function(evt) {
      const query = evt.target.value;
      if (query.length >= 3) {
        const newUrl = '/memos/search-all?q=' + encodeURIComponent(query);
        history.replaceState(null, '', newUrl);
      } else if (query.length === 0) {
        history.replaceState(null, '', '/memos/search-all');
      }
    });
  </script>
  
  <div class="row">
    <div class="col-12">
      <!-- Loading indicator -->
      <div id="search-loading" class="htmx-indicator alert alert-info">
        <div class="spinner-border spinner-border-sm me-2" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <span>Searching...</span>
      </div>
    </div>
  </div>
  
  <!-- Search content container -->
  <div id="search-content">
    <div class="row">
    <% if @query && @query.length >= 3 %>
      <%= render 'memos/_search_results' %>
    <% else %>
      <!-- Empty state -->
      <div class="col-12 text-center text-muted py-5">
        <p>Start typing to search across all your memos (minimum 3 characters)</p>
        <small>ðŸ’¡ Tip: Use multiple words for AND search</small>
      </div>
    <% end %>
    </div>
  </div>
</div>
